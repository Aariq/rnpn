---
title: "Downloading and Using USA-NPN Data"
author: "Lee Marsh"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The USA National Phenology Network (USA-NPN) is a USGS funded organization that collects phenological observations records from citizen and professional scientists to better understand the impact of changes in the environment to the timing of species’ lifecycles. The USA-NPN also provides a number of raster-based climatological data sets and phenological models.  These in-situ observations and geospatial datasets are available through a number of tools and data services, and this R library serves as a wrapper to some of those services.

## NPN In-Situ Data and Status Monitoring

To use the NPN’s phenological observations it helps to understand the structure of the data. Many phenological observing programs use “event monitoring”, which captures the onset date of a particular phenophase for an individual plant. The NPN, however, uses something quite different called “status monitoring”. Status monitoring entails taking regular reports on individual plants or animal species and indicating through a series of ‘Yes’, ‘No’, and ‘Not Sure’ questions, captures the full range of possible activities for a plant or animal and includes negative data which provides greater context and less error in interpreting onset dates.

This data is collected by asking observers to register a location, and then at each location they register any number of individual plants or animal species. The expectation is that the user then takes regular observations on each individual/species at some regular interval. Each observation is comprised of a series of 1/0/-1 values, representing yes/no/not sure for each possible phenophase for the plant on that date.

Retrieving this kind of data using the library is easy, and heavily parameterized. It’s possible to filter data on a number of parameters including year, geographic extent and species.

```{r}
library(rnpn)
data <- npn_download_status_data(request_source='R-Library-Example', year=c(2015), species_ids=c(15,16))
```


Note that specifying the year(s) of interest is a required parameter. There’s also another required field (seen above), “request_source”, which is a user-provided, self-identifying string. This allows the client to provide some information about who is accessing the data. The value provided here is entirely honor based.

The results returned from the service is a tabular set of phenophase records. By default, each record contain information about the location, species, phenophase and status.

```{r}
print(data[0:5])
```


You can also specify additional data fields to be returned using the additional_fields parameter as demonstrated here:

```{r}
additional_field_data <- npn_download_status_data(request_source='R-Library-Example', year=c(2015), species_ids=c(15,16), additional_fields=c('Station_Name', 'Plant_Nickname' ))
```


Some of the query parameters depend on specifying the primary key of other tables from the NPN database, for instance, the species id. There are other functions in the library that can help facilitate this. For instance, if you wanted to query all red maple records from 2015, you need to first know the id from ‘red maple’, as seen in the example below:

```{r}
all_species <- npn_species()
red_maple_id <- all_species[all_species$common_name == "red maple",]$species_id
#additional_field_data <- npn_download_status_data(request_source='R-Library-Example', year=c(2015), species_ids=c(red_maple_id))

#additional_field_data[1:10]
```

Getting the observational records like this is the most basic format the data comes in, and is the most robust for doing analysis, but there are a number of other products offered through the data service which provide additional value to data end users.

## Individual Phenometrics


